<dom-module id="app-elem">

  <style>
    :host {
      display: block;
    }
  </style>

  <template>
    <iron-ajax id="my_iron_elem" auto url="/applications" handle-as="json" on-response="handleResponse"></iron-ajax>
    <iron-ajax id="my_iron_save" method="PUT" handle-as="json" on-response="handleResponse_post"></iron-ajax>
    <span class="paper-font-body1">{{currentitem.id}}</span><br>
    <span class="paper-font-body1">{{currentitem.position}}</span><br>
    <span class="paper-font-body1">{{currentitem.company}}</span><br>
    <paper-input value={{currentitem.company}}></paper-input><br>
    <paper-button on-click="refresh_me">refresh</paper-button>
    <paper-button on-click="save_me">save</paper-button>

    in the end is <span>{{objid}}</span>
  </template>

</dom-module>

<script>
  (function () {
    Polymer({

      is: 'app-elem',
      properties: {
        currentitem: {
          type: Object,
          notify: true,
        },
        objid: {
          type: Number,
          notify: true,
          observe:'_obj_id_has_changed'
        }
      },

      ready: function() {
        console.log('My object has id ', this.objid);
        console.log('app-elem. I am ready');
        this.$.my_iron_elem.generateRequest();
      },

      refresh_me:function(){
        console.log('My object has id ', this.objid);
        var newUrl = "/applications/" + String(this.objid);
        console.log('My new url is ', newUrl);
        this.$.my_iron_elem.url = newUrl;
        this.$.my_iron_elem.generateRequest();
      },

      open_me: function(e) {
        var model = e.model;
        var id = model.item.id;
        console.log('the id is', id);
        page('#!/apps/' + String(id));
        //window.location = '#!/apps/' + String(id);
        //window.location.reload();
        //model.set('item.ordered', model.item.ordered+1);
      },

      save_me:function(){
        console.log('Saving my object, which is: ', this.objid);
        var newUrl = "/applications/" + String(this.objid) + '/';
        console.log('My new url is ', newUrl);
        this.$.my_iron_save.url = newUrl;
        this.$.my_iron_save.body = JSON.stringify(this.currentitem);
        this.$.my_iron_save.contentType = "application/json";
        this.$.my_iron_save.generateRequest();
      },

      handleResponse:function(response){
        console.log('Received response !' , response.detail.response);
        this.currentitem = response.detail.response;
      },

      handleResponse_post:function(response){
        console.log('Received response POST !' , response.detail.response);
        this.currentitem = response.detail.response;
      },

      _obj_id_has_changed:function(new_value, old_value){
        console.log('before : ', old_value, 'after : ', new_value);
      }

    });
  })();
</script>
