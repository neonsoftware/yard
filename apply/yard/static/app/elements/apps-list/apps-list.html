<dom-module id="apps-list">

  <style>

    paper-button[raised].colorful {
      background: #4285f4;
      color: #fff;
      @apply(--layout-vertical --layout-center-center);
    }

    [card] {
      width: 600px;
      margin: 16px auto;
      padding: 16px;
      @apply(--layout-vertical --layout-center-center);
    }

    [centerButton] {
      text-align: center;
      padding: 16px;
    }

  </style>

  <template>
    <iron-ajax id="my_iron" auto method="GET" url="{{serverurl}}"  handle-as="json" on-response="handleResponse"></iron-ajax>
    <paper-material levation="1">
      <div >
       <table card>
  				<tr>
  					<th>Position</th>
  					<th><iron-icon icon="question-answer" style="width: 18px; height: 18px;"></iron-icon></th>
  					<th><iron-icon icon="communication:call" style="width: 18px; height: 18px;"></iron-icon></th>
  					<th><iron-icon icon="perm-identity" style="width: 18px; height: 18px;"></iron-icon></th>
  					<th><iron-icon icon="more-horiz" style="width: 18px; height: 18px;"></iron-icon></th>
  					<th>Next</th>
  					<th></th>
  				</tr>

          <template is="dom-repeat" items="{{onlineItems}}">
            <tr on-click="open_me">
    					<td>
    						<span style="font-size: 12px;">{{item.position}}</span><br>
    						<span style="font-size: 11px;">{{item.company}}</span>
    						<span style="font-size: 9px; color: grey; ">&nbsp;&nbsp;via</span>
    						<span style="font-size: 9px; color: grey; ">{{item.portal}}</span>
    					</td>
              <td> <paper-checkbox checked="{{item.written}}"></paper-checkbox></td>
              <td> <paper-checkbox checked="{{item.called}}"></paper-checkbox></td>
              <td> <paper-checkbox checked="{{item.interviewed}}"></paper-checkbox></td>
              <td> <paper-checkbox checked="{{item.followup}}"></paper-checkbox></td>

              <td>{{item.next}}</td>
    					<td>
    						<iron-icon icon="create" style="width: 18px; height: 18px;"></iron-icon >
    						<iron-icon  icon="delete" style="width: 18px; height: 18px;" ></core-icon >
    					</td>
  				  </tr>
          </template>
       </table>
     </div>
     <div centerButton>
         <paper-button tabindex="0" raised class="colorful" on-click="open_new">new</paper-button>
     </div>
    </paper-material>
  </template>
</dom-module>

<script>
  (function () {
    Polymer({

      is: 'apps-list',
      properties: {
        serverurl: {
          type: String,
          value: ""
        },
        debug: {
          type: Boolean,
          value: false
        }
      },
      
      open_me: function(e) {
        var model = e.model;
        var id = model.item.id;
        if(this.debug) console.log('app-list : opening ', id);
        window.location = '#!/apps/' + String(id);
        window.location.reload();
        //model.set('item.ordered', model.item.ordered+1);
      },

      open_new: function(e) {
        if(this.debug) console.log('app-list : creating new');
        window.location = '#!/apps/new' ;
        window.location.reload();
      },

      handleResponse:function(response){
        console.log("ebug is switched  ", this.debug);
        if(this.debug) console.log("app-list : GET returned ", response.detail.response);
        this.onlineItems = response.detail.response;
      }

    });
  })();
</script>
