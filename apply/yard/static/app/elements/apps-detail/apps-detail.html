<dom-module id="apps-detail">

  <style>
    :host {
      display: block;
    }

    paper-button[raised].colorful {
      background: #4285f4;
      color: #fff;
      @apply(--layout-vertical --layout-center-center);
    }

    [card] {
      width: 600px;
      margin: 16px auto;
      padding: 16px;
      @apply(--layout-vertical --layout-center-center);
    }

    [centerButton] {
      text-align: center;
      padding: 16px;
    }

  </style>

  <template>
    <iron-ajax id="my_iron_elem" handle-as="json" on-response="handleResponse"></iron-ajax>
    <iron-ajax id="my_iron_save" handle-as="json" on-response="handleResponse_post"></iron-ajax>

    <paper-material card elevation="1">

      <paper-input type="text" value="{{currentitem.company}}" error="Company should have a name"></paper-input>
    	<paper-input label="Company website" floatingLabel=true value="{{currentitem.company_link}}" error="Company should have a name"></paper-input>
    	<paper-input label="Portal" floatingLabel=true value="{{currentitem.portal}}" error="Portal should have a name"></paper-input>
    	<paper-input label="Portal Website" floatingLabel=true value="{{currentitem.portal_link}}" error="Portal should have a name"></paper-input>
    	<paper-input label="Position" floatingLabel=true value="{{currentitem.position}}" error="Portal should have a name"></paper-input>
    	<paper-input label="Position link" floatingLabel=true value="{{currentitem.position_link}}" error="Portal should have a name"></paper-input>
    	<paper-input label="Skills" floatingLabel=true value="{{currentitem.skills}}" error="Portal should have a name"></paper-input>
    	<paper-input label="Salary" floatingLabel=true value="{{currentitem.salary}}" error="Portal should have a name"></paper-input>
    	<paper-input label="Contract" floatingLabel=true value="{{currentitem.skills}}" error="Portal should have a name"></paper-input>

    	<br><br>

      <paper-checkbox checked="{{currentitem.written}}"></paper-checkbox>&nbsp;&nbsp;&nbsp;
      <core-icon  icon="question-answer"></core-icon>&nbsp;&nbsp;Written<br><br>
     	<paper-checkbox checked="{{currentitem.called}}"></paper-checkbox>&nbsp;&nbsp;&nbsp;
      <core-icon icon="communication:call" ></core-icon>&nbsp;&nbsp;Called<br><br>
      <paper-checkbox checked="{{currentitem.interviewed}}"></paper-checkbox>&nbsp;&nbsp;&nbsp;
      <core-icon icon="perm-identity" ></core-icon>&nbsp;&nbsp;Interviewed <br><br>
      <paper-checkbox checked="{{currentitem.followup}}"></paper-checkbox>&nbsp;&nbsp;&nbsp;
      <core-icon icon="more-horiz" ></core-icon>&nbsp;&nbsp;Followup<br><br>


    	<paper-input multiline label="Next" floatingLabel=true value="{{currentitem.next}}" error="Portal should have a name"></paper-input>
    	<paper-input multiline label="Notes" floatingLabel=true value="{{currentitem.notes}}" error="Portal should have a name"></paper-input>
    	<paper-input multiline label="Cover Letter" floatingLabel=true value="{{currentitem.cover}}" error="Portal should have a name"></paper-input>
    	<paper-input multiline label="Address 1" floatingLabel=true value="{{currentitem.address1}}" error="Portal should have a name"></paper-input>
    	<paper-input multiline label="Address 2" floatingLabel=true value="{{currentitem.address2}}" error="Portal should have a name"></paper-input>

      <br>

      <h4> Contacts </h4>

    	<paper-input multiline label="Name" floatingLabel=true value="{{currentitem.c1name}}" error="Portal should have a name"></paper-input>
    	<paper-input multiline label="Email" type="email" floatingLabel=true value="{{currentitem.c1mail}}" error="Portal should have a name"></paper-input>
    	<paper-input multiline label="Phone" type="tel" floatingLabel=true value="{{currentitem.c1phone}}" error="Portal should have a name"></paper-input>

      <br><br>
    	<paper-input multiline label="Name" floatingLabel=true value="{{currentitem.c2name}}" error="Portal should have a name"></paper-input>
    	<paper-input multiline label="Email" type="email" floatingLabel=true value="{{currentitem.c2mail}}" error="Portal should have a name"></paper-input>
    	<paper-input multiline label="Phone" type="tel" floatingLabel=true value="{{currentitem.c2phone}}" error="Portal should have a name"></paper-input>

      <br><br>
    	<paper-input multiline label="Name" floatingLabel=true value="{{currentitem.c3name}}" error="Portal should have a name"></paper-input>
    	<paper-input multiline label="Email" type="email" floatingLabel=true value="{{currentitem.c3mail}}" error="Portal should have a name"></paper-input>
    	<paper-input multiline label="Phone" type="tel" floatingLabel=true value="{{currentitem.c3phone}}" error="Portal should have a name"></paper-input>

      <br><br>
    	<paper-input multiline label="Name" floatingLabel=true value="{{currentitem.c4name}}" error="Portal should have a name"></paper-input>
    	<paper-input multiline label="Email" type="email" floatingLabel=true value="{{currentitem.c4mail}}" error="Portal should have a name"></paper-input>
    	<paper-input multiline label="Phone" type="tel" floatingLabel=true value="{{currentitem.c4phone}}" error="Portal should have a name"></paper-input>


      <br>
      <h4> Map </h4>
      	<paper-input id="appl-latitude" label="Latitude" floatingLabel=true value="{{currentitem.latitude}}" error="Portal should have a name"></paper-input>
      	<paper-input id="appl-longitude" label="Longitude" floatingLabel=true value="{{currentitem.longitude}}" error="Portal should have a name"></paper-input>
      <br><br>

      <div  centerButton>
          <paper-button>discard</paper-button>
          <paper-button on-click="save_me" tabindex="0" raised class="colorful">save</paper-button>
          <paper-toast id="saving-complete" duration="6000" text="Saving successful!"> </paper-toast>
      </div>

    </paper-material>

  </template>

</dom-module>

<script>
  (function () {
    Polymer({

      is: 'apps-detail',
      properties: {
        is_new: Boolean,
        currentitem: {
          type: Object,
          notify: true,
        },
        objid: {
          type: Number,
          notify: true,
          observer:'_obj_id_has_changed'
        }
      },

      ready: function() {
        console.log('My object has id ', this.objid);
        console.log('app-elem. I am ready');
        this.$.my_iron_elem.generateRequest();
      },

      save_me:function(){
        if ( this.is_new ) {
          console.log('Saving new object. POST');
          this.$.my_iron_save.url = "/applications" ;
          this.$.my_iron_save.method = "POST"
        } else {
          console.log('Updating object. PUT');
          this.$.my_iron_save.url = "/applications/" + String(this.objid) + '/';
          this.$.my_iron_save.method = "PUT"
        }
        this.$.my_iron_save.body = JSON.stringify(this.currentitem);
        this.$.my_iron_save.contentType = "application/json";
        this.$.my_iron_save.generateRequest();
        document.querySelector('#saving-complete').show();
      },

      handleResponse:function(response){
        console.log('Received response from get :' , response.detail.response);
        this.currentitem = response.detail.response;
      },

      handleResponse_post:function(response){
        console.log('Received response from post :' , response.detail.response);
      },

      refresh_me:function(){
        this.$.my_iron_elem.url = "/applications/" + String(this.objid);
        this.$.my_iron_elem.generateRequest();
      },

      _obj_id_has_changed:function(new_value, old_value){
        this.is_new = ( new_value === "new" );
        console.log("Is new : ", this.is_new);
        if (!this.is_new){
          this.refresh_me();
        }
      }

    });

    window.addEventListener('WebComponentsReady', function() {
      console.log("WebComponentsReady");
    });
  })();
</script>
