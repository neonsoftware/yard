angular.module("autoFields",["ui.bootstrap"]).directive("autoFields",["$compile",function(e,t){return{restrict:"E",priority:1,replace:true,compile:function(){return function(t,n,r){var i=r.fields||r.autoFields,s=r.options,o=r.data,u=r.form||"autoFields",a=null;var f={classes:{formGroup:"form-group",input:"form-control",label:"control-label",col:"col-sm-"},container:'<div class="autoFields" ng-form name="'+u+'"></div>',defaultOption:"Select One",validation:{enabled:true,showMessages:true,defaultMsgs:{required:"This field is required",minlength:"This is under minimum length",maxlength:"This exceeds maximum length",min:"This is under the minumum value",max:"This exceeds the maximum value",email:"This is not a valid email address",valid:"This field is valid"}},dateSettings:{showWeeks:false},textareaRows:3,fixUrl:true};t.dateSettings=f.dateSettings;if(t.tabIndex==null)t.tabIndex=1;var l=function(e,t){var n='<div class="'+f.classes.formGroup+" "+e.type+'"';if(f.validation.enabled){n+=" ng-class=\"{'has-error':"+C(e)+", 'has-success':"+k(e)+'}"'}n+=">";switch(e.type){case"checkbox":n+=d(e,t);break;case"multiple":n='<div class="'+e.type+'">';n+=p(e,t);break;case"date":n+=h(e);n+=v(e,t);break;case"select":n+=h(e);n+=g(e,t);break;case"textarea":n+=h(e);n+=y(e,t);break;default:n+=h(e);n+=b(e,t);break}n+="</div>";return n};var c=function(e){return e.label||T(e.property)};var h=function(e){return'<label class="'+f.classes.label+'" for="'+e.property+'">'+c(e)+"</label>"};var p=function(e,t){var n='<div class="row">';var r=[];var s=angular.copy(i);i+="["+t+"].fields";angular.forEach(e.fields,function(t,n){var i='<div class="'+f.classes.col+(t.columns||e.columns)+'">';i+=l(t,n);i+="</div>";r.push(i)});i=s;n+=r.join(" ")+"</div>";return n};var d=function(e,t){var n='<label> <input type="checkbox"'+m(e,t)+E(e,t)+"/> "+c(e)+"</label>";return n};var v=function(e,t){return'<input type="text" show-weeks="dateSettings.showWeeks" datepicker-popup="MMMM dd, yyyy"'+m(e,t)+E(e,t)+" />"};var m=function(e,n){var r=' id="'+e.property+'" tabindex="'+t.tabIndex+'" name="'+e.property+'" ng-model="'+(e.value?"autoForm"+i.replace(/(\[|\])/g,"_")+n+".model":o+"['"+e.property+"']")+'" placeholder="'+(e.placeholder?e.placeholder:c(e))+'" ';if(e.value!=null)r+='value-function="'+i+"["+n+'].value"';if(e.type!="checkbox")r+='class="'+f.classes.input+" "+e.type+'" ';t.tabIndex++;return r};var g=function(e,t){var n='<select ng-options="'+e.list+'"';n+=m(e,t);if(e.attr!=null)n+=E(e,t);n+=">";n+='<option value="">'+(e.defaultOption?e.defaultOption:f.defaultOption)+"</option>";n+="</select>";return n};var y=function(e,t){var n='<textarea rows="'+(e.rows?e.rows:f.textareaRows)+'"';n+=m(e,t);if(e.attr!=null)n+=E(e,t);n+="></textarea>";return n};var b=function(e,t){var n='<input type="'+e.type+'"';n+=m(e,t);if(e.attr!=null)n+=E(e,t);if(e.type=="url"&&(e.fixUrl==true||f.fixUrl==true))n+="fix-url";n+="></input>";return n};var w=function(e,t){var n=[];angular.forEach(angular.extend({},f.validation.defaultMsgs,e.msgs),function(t,r){if(e.msgs&&e.msgs[r]!=null||e.type==r||e.attr&&(e.attr[r]!=null||e.attr["ng"+T(r)]!=null))n.push("("+u+"."+e.property+".$error."+r+"? '"+t+"' : '')")});var r=e.msgs&&e.msgs.valid?e.msgs.valid:f.validation.defaultMsgs.valid;if(n.length)var i=' popover-trigger="focus" popover="{{('+k(e)+")? '"+r+"' : ("+n.join("+")+')}}" popover-placement="top"';return i};var E=function(e,t){var n=[];angular.forEach(e.attr,function(e,t){var r=N(t)+'="'+e+'"';n.push(r)});return n.join(" ")+(f.validation.enabled&&f.validation.showMessages?w(e,t):"")};var S=null;var x=function(n){n=n||t[i];a.html("");angular.forEach(n,function(e,t){a.append(l(e,t))});if(S!=null)S.$destroy();S=t.$new();S.data=t[o];S.fields=n;e(a)(S)};t.$watch(s,function(e,t){L(f,e);if(e!==t)x()},true);t.$watch(i,function(e){x(e)},true);a=angular.element(f.container);n.replaceWith(a);var T=function(e){return e.replace(/([A-Z])/g," $1").replace(/^./,function(e){return e.toUpperCase()})};var N=function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()};var C=function(e){return u+"."+e.property+".$invalid && "+u+"."+e.property+".$dirty"};var k=function(e){return u+"."+e.property+".$valid"};var L=function(e){angular.forEach(arguments,function(t){if(t!==e){angular.forEach(t,function(t,n){if(e[n]&&e[n].constructor&&e[n].constructor===Object){L(e[n],t)}else{e[n]=t}})}});return e}}}}}]).directive("fixUrl",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){var i=/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w\.\-\?\=\&]*)$/i;var s=function(){var e=r.$modelValue;if(e==null)return;for(var t in r.$formatters){e=r.$formatters[t](e)}r.$viewValue=e;r.$render()};t.bind("blur",s);var o=function(e){var t=i.test(e);if(t){var n=e.match(i);var r=n[1]!=null&&n[1]!=""?n[1]:"http://";r+=n[2]+"."+n[3];if(typeof n[4]!="undefined")r+=n[4];e=r}return e};r.$formatters.push(o);r.$parsers.unshift(o)}}}]).directive("valueFunction",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){var i=e.$eval(n.valueFunction);e.$watch(n.valueFunction+"()",function(t){if(t!=null){e.$eval(n.ngModel+"="+n.valueFunction+"()")}});var s=function(t){i(e.$eval(n.ngModel));if(t!==true){e.$apply()}};e.$watch(n.ngModel,function(){if(s!=null){s(true)}})}}}])