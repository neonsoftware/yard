<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/iron-selector/iron-selector.html">
<link rel="import" href="bower_components/iron-pages/iron-pages.html">
<link rel="import" href="bower_components/more-routing/more-routing.html">
<link rel="import" href="bower_components/more-routing/more-route-selector.html">

<link rel="import" href="bower_components/cork/apps-home.html">
<link rel="import" href="bower_components/cork/apps-list.html">
<link rel="import" href="bower_components/cork/apps-detail.html">
<link rel="import" href="bower_components/cork/blocks-list.html">
<link rel="import" href="bower_components/cork/blocks-detail.html">
<link rel="import" href="bower_components/cork/templates-list.html">
<link rel="import" href="bower_components/cork/templates-detail.html">
<link rel="import" href="bower_components/cork/covers-list.html">
<link rel="import" href="bower_components/cork/covers-detail.html">
<link rel="import" href="bower_components/cork/covers-new.html">
<link rel="import" href="bower_components/cork/cork-badges.html">
<link rel="import" href="bower_components/cork/cork-language.html">
<link rel="import" href="bower_components/cork/apps-login.html">

<dom-module id="cork-app">

  <style>
  iron-selector > * {
    display: none;
  }
  iron-selector > .iron-selected {
    display: block;
  }

  </style>

  <template>

    <more-route-selector id="my_selector" selected-route={{selRoute}} selected-params={{selParams}}
                                          on-unauthenticated="_on_401" on-servererror="_on_403"
                                          on-saveok="_on_saveok" on-saveerror="_on_saveerror">
      <iron-pages>
        <section route="root">
          <more-route context name="root" active="{{rt_active}}"></more-route>
          <apps-home active={{rt_active}} serverurl="http://yard.neonrain.space/applications"></apps-home>
        </section>

        <section route="login">
          <more-route context name="login" active="{{rt_active}}"></more-route>
          <apps-login active={{rt_active}} loginurl="http://yard.neonrain.space/simplelogin"></apps-login>
        </section>

        <section route="apps">
          <more-route context name="apps" active="{{al_active}}"></more-route>
          <apps-list active="{{al_active}}" serverurl="http://yard.neonrain.space/applications"></apps-list>
        </section>

        <section route="appdetail">
          <more-route context name="appdetail" active="{{ad_active}}" params="{{ad_params}}"></more-route>
          <apps-detail active={{ad_active}} appid={{ad_params.appId}} serverurl="http://yard.neonrain.space/applications"></apps-detail>
        </section>

        <section route="blocks">
          <more-route context name="blocks" active="{{bll_active}}"></more-route>
          <blocks-list active="{{bll_active}}" serverurl="http://yard.neonrain.space/pieces"></blocks-list>
        </section>

        <section route="blockdetail">
          <more-route context name="blockdetail" active="{{bl_active}}" params="{{bl_params}}"></more-route>
          <blocks-detail active={{bl_active}} elementid="{{bl_params.blockId}}" serverurl="http://yard.neonrain.space/pieces"></blocks-detail>
        </section>

        <section route="templates">
          <more-route context name="templates" active="{{tll_active}}"></more-route>
          <templates-list active="{{tll_active}}" serverurl="http://yard.neonrain.space/categories"></templates-list>
        </section>

        <section route="templatedetail">
          <more-route context name="templatedetail" active="{{tl_active}}" params="{{tl_params}}"></more-route>
          <templates-detail active={{tl_active}} elementid="[[tl_params.templateId]]" serverurl="http://yard.neonrain.space/categories" blocksserverurl="http://yard.neonrain.space/pieces"></templates-detail>
        </section>

        <section route="covers">
          <more-route context name="covers" active="{{cll_active}}"></more-route>
          <covers-list active="{{cll_active}}" serverurl="http://yard.neonrain.space/documents"></covers-list>
        </section>

        <section route="coverdetail">
          <more-route context name="coverdetail" active="{{cl_active}}" params="{{cl_params}}"></more-route>
          <covers-detail debug active=[[cl_active]] elementid="[[cl_params.coverId]]" templateid="[[cl_params.coverTemplateId]]" serverurl="http://yard.neonrain.space/documents" templateserverurl="http://yard.neonrain.space/categories"></covers-detail>
        </section>

        <section route="coverselect">
          <more-route context name="coverselect" active="{{cs_active}}"></more-route>
          <covers-new active="{{cs_active}}" serverurl="http://yard.neonrain.space/categories"></covers-new>
        </section>

      </iron-pages>
    </more-route-selector>

    <paper-toast id="save-success" duration="6000" text="Saving successful"> </paper-toast>
    <paper-toast id="save-failure" duration="6000" text="Could not save"> </paper-toast>

  </template>

  <script>

    Polymer({

      is: 'cork-app',

      properties: {
      },

      observers:[],

      _onMenuSelect : function() {
        var drawerPanel = document.querySelector('#paperDrawerPanel');
        if (drawerPanel.narrow) {
          drawerPanel.closeDrawer();
        }
      },

      _on_401 : function(){
        console.log("Arrived unauthenticated event");
        MoreRouting.navigateTo('login');
      },

      _on_403 : function(){
        console.log("Arrived servererror event");
      },

      _on_saveok : function(){
        console.log("Saving item went ok !");
        document.querySelector('#save-success').show();
        if(MoreRouting.isCurrentUrl('appdetail')){ MoreRouting.navigateTo('apps'); }
        if(MoreRouting.isCurrentUrl('blockdetail')){ MoreRouting.navigateTo('blocks'); }
        if(MoreRouting.isCurrentUrl('templatedetail')){ MoreRouting.navigateTo('templates'); }
        if(MoreRouting.isCurrentUrl('coverdetail')){ MoreRouting.navigateTo('covers'); }
      },

      _on_saveerror : function(){
        console.log("Saving item went .. bad.");
        document.querySelector('#save-error').show();
      }

    });

  </script>

</dom-module>
